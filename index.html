<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ch·ªçn h·ªçc sinh & V√≤ng quay To√°n</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #74ebd5, #ACB6E5);
      margin: 0; padding: 0; text-align: center; color: #333;
    }
    .step { display: none; margin-top: 40px; }
    .step.active { display: block; }
    button {
      padding: 12px 25px; margin-top: 20px; border: none; border-radius: 10px;
      background: linear-gradient(45deg, #ff4e50, #f9d423); color: white; font-size: 16px;
      cursor: pointer; transition: 0.3s; box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }
    button:hover { transform: scale(1.05); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
    .switch-bar { display: flex; justify-content: center; background: #ccc; padding: 10px; margin-bottom: 20px; }
    .switch-bar button { margin: 0 10px; background: #666; }
    .switch-bar button:hover { background: #444; }
    .panel { display: none; }
    .panel.active { display: block; }
    #studentList { margin-top: 15px; }
    #studentList span {
      display: inline-block; margin: 5px; padding: 8px 12px; border-radius: 6px;
      background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #studentList span.chosen {
      background: #ff4e50; color: white; text-decoration: line-through;
    }
    .wheel-container { position: relative; width: 500px; height: 500px; margin: 20px auto; }
    canvas { border-radius: 50%; box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
    .pointer {
      position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent;
      border-bottom: 40px solid red;
    }
    #resultText { margin-top: 25px; font-size: 1.2em; font-weight: bold; color: #222; padding: 0 15px; }
  </style>
</head>
<body>
  <!-- B∆∞·ªõc 1 -->
  <div id="step1" class="step active">
    <h2>B·∫°n ƒëang h·ªçc l·ªõp m·∫•y?</h2>
    <select id="classSelect">
      <option value="">--Ch·ªçn l·ªõp--</option>
      <option value="6">L·ªõp 6</option>
      <option value="7">L·ªõp 7</option>
      <option value="8">L·ªõp 8</option>
    </select>
    <br>
    <button onclick="nextStep(2)">Ti·∫øp t·ª•c</button>
  </div>

  <!-- B∆∞·ªõc 2 -->
  <div id="step2" class="step">
    <h2>C√≥ bao nhi√™u h·ªçc sinh?</h2>
    <input type="number" id="studentCount" placeholder="Nh·∫≠p s·ªë h·ªçc sinh">
    <br>
    <button onclick="generateStudents()">Ti·∫øp t·ª•c</button>
  </div>

  <!-- B∆∞·ªõc 3 -->
  <div id="step3" class="step">
    <div class="switch-bar">
      <button onclick="showPanel('student')">Ch·ªçn h·ªçc sinh</button>
      <button onclick="showPanel('wheel')">C√¢u h·ªèi To√°n</button>
    </div>

    <!-- Panel h·ªçc sinh -->
    <div id="studentPanel" class="panel active">
      <h2 id="studentResult">Nh·∫•n n√∫t ƒë·ªÉ ch·ªçn h·ªçc sinh</h2>
      <button onclick="pickStudent()">Ch·ªçn h·ªçc sinh</button>
      <div id="studentList"></div>
    </div>

    <!-- Panel v√≤ng quay -->
    <div id="wheelPanel" class="panel">
      <h2>C√¢u h·ªèi To√°n l·ªõp <span id="classTitle"></span></h2>
      <div class="wheel-container">
        <div class="pointer"></div>
        <canvas id="wheelCanvas" width="500" height="500"></canvas>
      </div>
      <button id="spinBtn">Quay ngay!</button>
      <p id="resultText"></p>
    </div>
  </div>

  <script>
    const mathQuestions = {
      "6": [
        "Vi·∫øt s·ªë t·ª± nhi√™n nh·ªè nh·∫•t c√≥ ba ch·ªØ s·ªë kh√°c nhau.",
        "Ph√¢n s·ªë n√†o l·ªõn h∆°n: 3/5 hay 4/7?",
        "T√≠nh gi√° tr·ªã c·ªßa 36 : 9 + 25.",
        "M·ªôt h√¨nh ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i 12 cm, chi·ªÅu r·ªông 8 cm. Chu vi b·∫±ng bao nhi√™u?",
        "Vi·∫øt s·ªë th·∫≠p ph√¢n b·∫±ng ph√¢n s·ªë 7/10.",
        "Trong c√°c s·ªë 45, 60, 75 s·ªë n√†o chia h·∫øt cho 9?",
        "M·ªôt h√¨nh vu√¥ng c√≥ c·∫°nh 5 cm. Di·ªán t√≠ch b·∫±ng bao nhi√™u?",
        "Vi·∫øt h·ªón s·ªë 3 2/5 d∆∞·ªõi d·∫°ng ph√¢n s·ªë.",
        "Tr√™n tia s·ªë, ƒëi·ªÉm n√†o bi·ªÉu di·ªÖn s·ªë 2/3?",
        "Vi·∫øt ba s·ªë nguy√™n li√™n ti·∫øp."
      ],
      "7": [
        "Gi√° tr·ªã c·ªßa 2x + 5 khi x = -3 l√† bao nhi√™u?",
        "T√¨m nghi·ªám c·ªßa ph∆∞∆°ng tr√¨nh: 3x - 7 = 5.",
        "M·ªôt tam gi√°c c√≥ c√°c g√≥c 40¬∞, 60¬∞. G√≥c c√≤n l·∫°i b·∫±ng bao nhi√™u?",
        "V·∫Ω ƒë·ªì th·ªã h√†m s·ªë y = 2x.",
        "Ph√¢n t√≠ch ƒëa th·ª©c x^2 + 5x th√†nh nh√¢n t·ª≠.",
        "So s√°nh hai ph√¢n s·ªë 5/8 v√† 7/12.",
        "M·ªôt h√¨nh b√¨nh h√†nh c√≥ ƒë√°y 10 cm, chi·ªÅu cao 6 cm. Di·ªán t√≠ch b·∫±ng bao nhi√™u?",
        "T√¨m x: 2(x-3) = 10.",
        "Cho t·ªâ l·ªá th·ª©c 3/x = 9/12. T√¨m x.",
        "S·ªë ƒë·ªëi c·ªßa s·ªë -15 l√† bao nhi√™u?"
      ],
      "8": [
        "T√≠nh gi√° tr·ªã c·ªßa bi·ªÉu th·ª©c: (x+3)(x-3).",
        "R√∫t g·ªçn ph√¢n th·ª©c: (x^2-9)/(x+3).",
        "Cho ph∆∞∆°ng tr√¨nh 2x + 5 = 0. T√¨m nghi·ªám.",
        "M·ªôt h√¨nh thang c√≥ ƒë√°y l·ªõn 12 cm, ƒë√°y nh·ªè 8 cm, chi·ªÅu cao 5 cm. Di·ªán t√≠ch b·∫±ng bao nhi√™u?",
        "T√¨m nghi·ªám c·ªßa h·ªá ph∆∞∆°ng tr√¨nh: x+y=7, x-y=1.",
        "T√≠nh chu vi h√¨nh tr√≤n c√≥ b√°n k√≠nh 7 cm. (L·∫•y œÄ = 3,14).",
        "R√∫t g·ªçn bi·ªÉu th·ª©c: (x^2-4)/(x-2).",
        "Cho g√≥c ·ªü t√¢m b·∫±ng 60¬∞. S·ªë ƒëo cung tr√≤n ch·∫Øn g√≥c ƒë√≥ l√† bao nhi√™u ƒë·ªô?",
        "M·ªôt v·∫≠t th·ªÉ c√≥ th·ªÉ t√≠ch h√¨nh l·∫≠p ph∆∞∆°ng c·∫°nh 4 cm l√† bao nhi√™u?",
        "T√¨m x: x/5 = 12/15."
      ]
    };

    let currentStep = 1;
    let totalStudents = 0;
    let students = [];
    let currentClass = null;
    let segments = [];
    let colors = [];
    let startAngle = 0;
    let arc = 0;
    let spinSpeed = 0;
    let spinning = false;

    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const resultText = document.getElementById("resultText");

    function nextStep(step) {
      document.getElementById(`step${currentStep}`).classList.remove("active");
      currentStep = step;
      document.getElementById(`step${currentStep}`).classList.add("active");

      if (step === 2) {
        currentClass = document.getElementById("classSelect").value;
        if (!currentClass) {
          alert("H√£y ch·ªçn l·ªõp tr∆∞·ªõc!");
          currentStep = 1;
          document.getElementById("step1").classList.add("active");
        }
      }
    }

    function generateStudents() {
      totalStudents = parseInt(document.getElementById("studentCount").value);
      if (!totalStudents || totalStudents <= 0) {
        alert("H√£y nh·∫≠p s·ªë h·ªçc sinh h·ª£p l·ªá!");
        return;
      }
      students = [];
      for (let i = 1; i <= totalStudents; i++) students.push(i);
      renderStudentList();
      nextStep(3);
      setupWheel();
    }

    function renderStudentList() {
      let html = "";
      for (let i = 1; i <= totalStudents; i++) {
        let chosen = students.includes(i) ? "" : "chosen";
        html += `<span class="${chosen}">${i}</span>`;
      }
      document.getElementById("studentList").innerHTML = html;
    }

    function showPanel(panel) {
      document.getElementById("studentPanel").classList.remove("active");
      document.getElementById("wheelPanel").classList.remove("active");
      document.getElementById(panel + "Panel").classList.add("active");
    }

    function pickStudent() {
      if (students.length === 0) {
        document.getElementById("studentResult").innerText = "üéâ ƒê√£ ch·ªçn h·∫øt h·ªçc sinh!";
        return;
      }
      let index = Math.floor(Math.random() * students.length);
      let student = students.splice(index, 1)[0];
      document.getElementById("studentResult").innerText = `üéØ H·ªçc sinh s·ªë: ${student}`;
      renderStudentList();
    }

    // ===== V√≤ng quay To√°n =====
    function setupWheel() {
      document.getElementById("classTitle").innerText = currentClass;
      segments = mathQuestions[currentClass];
      colors = segments.map((_, i) => i % 2 === 0 ? "#FF6B6B" : "#4D96FF");
      arc = Math.PI * 2 / segments.length;
      drawWheel();
    }

    function drawWheel() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < segments.length; i++) {
        let angle = startAngle + i * arc;
        ctx.fillStyle = colors[i];
        ctx.beginPath();
        ctx.moveTo(250, 250);
        ctx.arc(250, 250, 250, angle, angle + arc);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.save();
        ctx.fillStyle = "#fff";
        ctx.font = "bold 14px Segoe UI";
        ctx.translate(250 + Math.cos(angle + arc / 2) * 150, 250 + Math.sin(angle + arc / 2) * 150);
        ctx.rotate(angle + arc / 2 + Math.PI / 2);
        let text = segments[i];
        let shortText = text.length > 25 ? text.slice(0, 25) + "..." : text;
        ctx.fillText(shortText, -ctx.measureText(shortText).width / 2, 0);
        ctx.restore();
      }
    }

    function rotateWheel() {
      if (!spinning) return;
      spinSpeed *= 0.985;
      if (spinSpeed < 0.002) { stopRotateWheel(); return; }
      startAngle += spinSpeed;
      drawWheel();
      requestAnimationFrame(rotateWheel);
    }

    function stopRotateWheel() {
      let degrees = startAngle * 180 / Math.PI + 90;
      let arcd = 360 / segments.length;
      let index = Math.floor((360 - (degrees % 360)) / arcd) % segments.length;
      resultText.innerHTML = "üìò " + segments[index];
      spinning = false;
    }

    function spinWheel() {
      if (spinning) return;
      spinning = true;
      resultText.textContent = "";
      spinSpeed = Math.random() * 0.3 + 0.25;
      rotateWheel();
    }

    document.getElementById("spinBtn").addEventListener("click", spinWheel);
  </script>
</body>
</html>
